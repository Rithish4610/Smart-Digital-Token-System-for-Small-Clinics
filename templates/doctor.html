<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard - Smart Token System</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .queue-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            border-bottom: 1px solid rgba(94, 96, 206, 0.1);
            transition: all 0.3s ease;
        }

        .queue-item:hover {
            background: linear-gradient(135deg, rgba(94, 96, 206, 0.05) 0%, rgba(6, 214, 160, 0.05) 100%);
            transform: translateX(5px);
        }

        .queue-item:last-child {
            border-bottom: none;
        }

        .current-card {
            background: linear-gradient(135deg, #5e60ce 0%, #7209b7 100%);
            color: white;
            box-shadow: 0 12px 32px rgba(94, 96, 206, 0.4);
        }

        .current-card h2,
        .current-card p {
            color: white;
        }

        .token-number {
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>

<body>
    <div class="container fade-in">
        <div class="header">
            <div>
                <h1>üë®‚Äç‚öïÔ∏è Doctor's Dashboard</h1>
                <p style="color: var(--text-light); font-size: 1.05rem;">Manage your daily consultation queue</p>
            </div>
            <button class="btn btn-primary glow-on-hover" onclick="callNext()" style="font-size: 1.1rem;">üìû Call Next
                Patient</button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
            <!-- Currently Calling -->
            <div class="card current-card scale-in">
                <p
                    style="opacity: 0.9; font-weight: 600; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.1em;">
                    Currently Calling</p>
                <h1 id="currentToken" style="font-size: 4rem; margin: 1rem 0; font-weight: 900;">--</h1>
                <h2 id="currentName" style="margin: 0; font-size: 1.8rem;">No Patient</h2>
                <div style="margin-top: 2rem;">
                    <button class="btn glow-on-hover"
                        style="background: rgba(255,255,255,0.25); color: white; width: 100%; font-weight: 700; backdrop-filter: blur(10px);"
                        onclick="callNext()">‚úÖ Mark Complete & Next</button>
                </div>
            </div>

            <!-- Waiting Queue -->
            <div class="card fade-in" style="padding: 0; animation-delay: 0.2s;">
                <div
                    style="padding: 1.5rem; border-bottom: 2px solid rgba(94, 96, 206, 0.1); background: linear-gradient(135deg, rgba(94, 96, 206, 0.05) 0%, rgba(6, 214, 160, 0.03) 100%);">
                    <h3 style="margin: 0;">üìã Waiting List (<span id="queueCount" class="text-gradient">0</span>)</h3>
                </div>
                <div id="queueList" style="max-height: 500px; overflow-y: auto;">
                    <!-- Loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script>
        async function updateDashboard() {
            try {
                const res = await fetch('/api/queue');
                const data = await res.json();

                // Update Current
                if (data.current) {
                    document.getElementById('currentToken').innerText = `#${data.current.token}`;
                    document.getElementById('currentName').innerText = data.current.name;
                } else {
                    document.getElementById('currentToken').innerText = '--';
                    document.getElementById('currentName').innerText = 'No Patient';
                }

                // Update List
                document.getElementById('queueCount').innerText = data.waiting.length;
                const container = document.getElementById('queueList');
                container.innerHTML = '';

                data.waiting.forEach((p, index) => {
                    const div = document.createElement('div');
                    div.className = 'queue-item fade-in';
                    div.style.animationDelay = `${index * 0.05}s`;
                    div.innerHTML = `
                        <div>
                            <span class="token-number" style="font-size: 1.2rem; margin-right: 1rem;">#${p.token}</span>
                            <span style="font-weight: 600; color: var(--text);">${p.name}</span>
                        </div>
                        <span class="badge badge-waiting">‚è≥ Waiting</span>
                    `;
                    container.appendChild(div);
                });

                if (data.waiting.length === 0) {
                    container.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--text-light)">No patients waiting</div>';
                }
            } catch (err) {
                console.error('Update failed');
            }
        }

        async function callNext() {
            const res = await fetch('/api/next', { method: 'POST' });
            updateDashboard();
        }

        // Poll every 5 seconds for updates
        setInterval(updateDashboard, 5000);
        updateDashboard();
    </script>
</body>

</html>